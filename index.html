<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Î™πÎ™πÎü∞: ULSAN HYUNDAI MOBIS PHOEBUS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css');
        
        body {
            font-family: 'Galmuri11', sans-serif;
            background-color: #1a1a1a;
            margin: 0;
            overflow: hidden;
            touch-action: none; 
            user-select: none;
            color: #fff;
            font-weight: normal;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background-color: #d29145;
            overflow: hidden;
            image-rendering: pixelated;
        }

        #game-canvas { display: block; }

        /* Ï∂©Îèå Ìö®Í≥º Ïò§Î≤ÑÎ†àÏù¥ */
        #flash-overlay {
            position: absolute;
            inset: 0;
            background-color: transparent;
            pointer-events: none;
            z-index: 50;
            transition: background-color 0.1s;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .view {
            position: absolute;
            inset: 0;
            background: #e5e7eb;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
            color: black;
            z-index: 200;
            overflow-y: auto; 
            padding: 40px 20px;
        }

        .btn-pixel {
            background: #e30613;
            border: 4px solid #000;
            box-shadow: 4px 4px 0px #000;
            color: white;
            padding: 12px 24px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.05s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 260px;
            font-weight: normal;
        }
        .btn-pixel:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000; }

        /* ÏïÑÏù¥Îîî Ïπ¥Îìú ÎîîÏûêÏù∏ */
        .id-card {
            background: #fff;
            border: 4px solid #000;
            width: 320px;
            color: #000;
            padding: 0;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            font-family: 'Galmuri11', sans-serif;
        }
        .id-header {
            background: #002c5f;
            padding: 10px;
            border-bottom: 4px solid black;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        .id-header span { font-weight: normal; }
        .id-body { 
            padding: 15px; 
            display: flex; 
            gap: 15px; 
            background: #fff;
        }
        .id-photo-area {
            width: 80px;
            height: 100px;
            background: #e5e7eb;
            border: 3px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .id-info-main { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
        }
        .id-team { font-size: 10px; color: #666; font-weight: normal; }
        .id-name { font-size: 20px; color: #000; font-weight: normal; line-height: 1.2; }
        .id-number { font-size: 28px; color: #e30613; font-weight: bold; margin-top: 5px; }
        
        .id-footer {
            padding: 12px;
            background: #f3f4f6;
            border-top: 3px solid black;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 10px;
        }
        .info-row { display: flex; flex-direction: column; }
        .info-label { color: #888; font-size: 9px; margin-bottom: 2px; }
        .info-val { color: #000; font-weight: normal; }

        .quiz-card {
            background: white;
            border: 6px solid black;
            width: 340px;
            padding: 20px;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
            color: black;
        }
        .quiz-question-box {
            background: #e2e8f0;
            border: 4px solid black;
            padding: 15px;
            margin-bottom: 20px;
        }
        .quiz-option {
            width: 100%;
            padding: 12px;
            border: 4px solid black;
            background: #fff;
            text-align: center;
            box-shadow: 4px 4px 0px black;
            margin-bottom: 12px;
            cursor: pointer;
            color: black;
            font-weight: normal;
        }
        .quiz-option:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px black; }

        .clear-card {
            background: white;
            border: 6px solid black;
            width: 340px;
            padding: 24px;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.6);
            text-align: center;
            color: black;
        }
        .icon-btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }
        .tactile-btn {
            background: #f3f4f6;
            border: 4px solid black;
            border-bottom-width: 8px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .tactile-btn:active { border-bottom-width: 4px; transform: translateY(4px); }
        .tactile-btn.primary { background: #e30613; color: white; grid-column: span 2; border-color: black; }
        .tactile-btn.secondary { background: #2563eb; color: white; grid-column: span 2; border-color: black; }

        .hit-effect { animation: hit-shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes hit-shake { 
            0% { transform: translate(0, 0); }
            10%, 90% { transform: translate(-5px, -5px); } 
            20%, 80% { transform: translate(5px, 5px); } 
            30%, 50%, 70% { transform: translate(-10px, 5px); } 
            40%, 60% { transform: translate(10px, -5px); } 
            100% { transform: translate(0, 0); }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="flash-overlay"></div>
        <canvas id="game-canvas"></canvas>
        <div id="damage-msg"></div>

        <!-- Ïù∏Í≤åÏûÑ ÏÉÅÎã® UI -->
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-start z-10 pointer-events-none text-white text-black">
            <div class="flex flex-col space-y-2">
                <div id="lives-bar" class="flex gap-1 h-10 min-w-[60px]"></div>
                <div class="bg-black/80 border-2 border-white p-2">
                    <h1 class="text-[10px] text-yellow-400 uppercase font-normal">STAGE <span id="ui-level">1</span></h1>
                    <div class="text-[10px] mt-1 font-normal text-white">DIST: <span id="ui-score">0</span>m</div>
                    <div class="text-[9px] mt-0.5 opacity-70 uppercase font-normal text-white">BEST: <span id="ui-best-game">0</span>m</div>
                </div>
            </div>
            <div class="flex flex-col items-end space-y-2">
                <div class="text-right bg-black/80 border-2 border-white p-2 min-w-[130px]">
                    <div class="text-yellow-300 text-[10px] uppercase font-normal">MP: <span id="ui-mp">0</span></div>
                    <div class="w-full h-2 bg-gray-700 mt-1 border border-white overflow-hidden">
                        <div id="ui-shotclock" class="h-full bg-red-600 w-full"></div>
                    </div>
                </div>
                <button onclick="togglePause()" class="pointer-events-auto bg-black border border-white px-3 py-1 text-[10px] font-normal text-white">|| PAUSE</button>
            </div>
        </div>

        <!-- ÏãúÏûë ÌôîÎ©¥ -->
        <div id="overlay-start" class="overlay text-center">
            <div class="mb-4 bg-white border-4 border-black p-2 shadow-2xl">
                <canvas id="preview-canvas" width="80" height="80"></canvas>
            </div>
            <h2 class="text-6xl font-normal text-yellow-400 italic mb-4 text-black">Î™πÎ™πÎü∞</h2>
            <div class="mb-6 text-white font-normal">
                <div class="inline-block bg-red-600 text-white px-4 py-1 text-sm border-2 border-black uppercase font-normal">BEST RECORD: <span id="ui-best-main">0</span>m</div>
            </div>
            <div class="bg-black/40 p-4 mb-8 border border-white/20 w-72 mx-auto text-white font-normal">
                <p id="ui-collect-main" class="text-[11px] font-normal uppercase">ROSTER: 1/29</p>
            </div>
            <div class="flex flex-col space-y-4">
                <button onclick="startGame()" class="btn-pixel">Í≤Ω Í∏∞ Ïãú Ïûë</button>
                <button onclick="switchTab('collection')" class="btn-pixel bg-blue-600">ÏÑ† Ïàò Î¶¨ Ïä§ Ìä∏</button>
                <button onclick="switchTab('shop')" class="btn-pixel bg-green-600 text-white font-normal">Ìîº Î≤Ñ Ïä§ ÏÉµ</button>
            </div>
        </div>

        <!-- ÏÑ†Ïàò Î¶¨Ïä§Ìä∏ Î∑∞ -->
        <div id="view-collection" class="view hidden text-black font-normal">
            <div class="w-full max-w-md flex justify-between items-center mb-6 pt-4 text-black sticky top-0 bg-gray-100 py-4 z-50 px-4 rounded-lg border-b-4 border-black">
                <h2 class="text-2xl font-normal uppercase text-black">PHOEBUS ROSTER (<span id="ui-collected-count">0</span>/29)</h2>
                <button onclick="closeViews()" class="bg-black text-white px-4 py-2 font-normal shadow-md">X</button>
            </div>
            <div id="player-grid" class="grid grid-cols-2 gap-4 pb-20 w-full max-w-md text-black"></div>
        </div>

        <!-- ÌîºÎ≤ÑÏä§ ÏÉµ Î∑∞ -->
        <div id="view-shop" class="view hidden bg-red-50 text-black font-normal">
            <div class="w-full max-w-md flex justify-end mb-4 pt-4">
                <button onclick="closeViews()" class="bg-black text-white px-4 py-2 font-normal shadow-md">X</button>
            </div>
            <div class="bg-white border-4 border-black p-8 max-w-sm w-full text-center shadow-[12px_12px_0px_#000]">
                <h3 class="text-3xl font-normal mb-4 uppercase text-red-600">PHOEBUS SHOP</h3>
                <div class="bg-gray-100 p-4 border-2 border-black mb-8 font-normal text-xl text-black">MY MP: <span id="ui-shop-mp" class="text-red-600">0</span></div>
                <div class="flex flex-col space-y-6">
                    <button onclick="buyLife()" class="btn-pixel bg-yellow-400 text-black text-sm font-normal w-full">LIFE UP (500 MP)</button>
                    <button onclick="scoutPlayer()" class="btn-pixel bg-red-600 text-white text-sm font-normal w-full">SCOUT (100 MP)</button>
                </div>
            </div>
        </div>

        <!-- Ìå¨ ÌÄ¥Ï¶à -->
        <div id="overlay-quiz" class="overlay hidden text-black">
            <div class="quiz-card">
                <h3 class="text-xl text-red-600 mb-4 uppercase border-b-4 border-black pb-2 font-normal text-black">PHOEBUS MISSION</h3>
                <div class="quiz-question-box text-black font-normal">
                    <p id="quiz-question" class="text-lg leading-snug font-normal"></p>
                </div>
                <div id="quiz-options" class="flex flex-col text-black font-normal"></div>
                <div id="quiz-feedback" class="mt-2 text-center hidden font-normal"></div>
                <button id="quiz-next-btn" onclick="moveToClearScreen()" class="mt-4 w-full h-12 bg-black text-white font-normal hidden uppercase text-sm">Confirm</button>
            </div>
        </div>

        <!-- Îã®Í≥Ñ ÌÅ¥Î¶¨Ïñ¥ -->
        <div id="overlay-clear" class="overlay hidden text-black">
            <div class="clear-card">
                <div class="w-16 h-16 bg-yellow-400 rounded-full border-4 border-black flex items-center justify-center mx-auto mb-4 text-black"><span class="text-3xl text-black">üèÄ</span></div>
                <h2 class="text-4xl font-normal italic text-red-600 mb-2 font-normal text-black">LEVEL CLEAR</h2>
                <p id="ui-clear-stats" class="text-xs font-normal text-gray-400 mb-6 uppercase tracking-widest"></p>
                
                <div class="bg-gray-100 border-4 border-black p-4 flex justify-between items-center px-6 mb-6 text-black font-normal">
                    <span class="text-xs uppercase text-black font-normal">TOTAL Points</span>
                    <span class="text-2xl text-red-600 font-bold"><span id="ui-clear-mp">0</span></span>
                </div>

                <div class="icon-btn-grid text-black font-normal">
                    <!-- 1. ÏÉùÎ™Ö Íµ¨Îß§ -->
                    <div onclick="buyLife()" class="tactile-btn">
                        <span class="text-2xl mb-1">ü¶Å</span>
                        <span class="btn-label text-black">ÏÉùÎ™Ö Íµ¨Îß§</span>
                        <span class="btn-cost">500 MP</span>
                    </div>
                    <!-- 2. ÏÑ†Ïàò ÎΩëÍ∏∞ -->
                    <div onclick="scoutPlayer()" class="tactile-btn">
                        <span class="text-2xl mb-1">üÉè</span>
                        <span class="btn-label text-black">ÏÑ†Ïàò ÎΩëÍ∏∞</span>
                        <span class="btn-cost">100 MP</span>
                    </div>
                    <!-- 3. ÏÑ†Ïàò ÍµêÏ≤¥ -->
                    <div onclick="switchTab('collection')" class="tactile-btn">
                        <span class="text-2xl mb-1">üîÑ</span>
                        <span class="btn-label text-black">ÏÑ†Ïàò ÍµêÏ≤¥</span>
                    </div>
                    <!-- 4. Îã§Ïùå Î†àÎ≤® -->
                    <div onclick="continueGame()" class="tactile-btn" style="background-color: #e30613; border-color: black;">
                        <span class="text-2xl mb-1 text-white">‚ñ∂</span>
                        <span class="btn-label text-white">Îã§Ïùå Î†àÎ≤®</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Í≤åÏûÑ Ïò§Î≤Ñ -->
        <div id="overlay-over" class="overlay hidden">
            <h2 class="text-6xl font-normal text-red-500 italic uppercase mb-2 font-normal text-white">Game Over</h2>
            <p id="ui-final-stats" class="text-lg font-normal mb-8 text-center uppercase text-white"></p>
            <div class="flex flex-col space-y-4 font-normal text-white">
                <button onclick="resetGame()" class="btn-pixel bg-white text-black font-normal">Îã§Ïãú ÎèÑÏ†Ñ</button>
                <button onclick="switchTab('collection')" class="btn-pixel bg-blue-600 text-white font-normal">ÏÑ†Ïàò Î¶¨Ïä§Ìä∏</button>
            </div>
        </div>

        <div id="modal" class="fixed inset-0 bg-black/95 z-[300] flex items-center justify-center hidden p-6 text-black">
            <div id="scout-result" class="text-black font-normal"></div>
        </div>
    </div>

    <script>
        /**
         * --- 1. ÏÉÅÏàò Î∞è Ï¥àÍ∏∞Ìôî ---
         */
        const LANE_HEIGHT = 80, GRID_SIZE = 60, LEVEL_DIST = 50, MAX_LIVES = 5;
        let canvas, ctx, animationFrameId;
        let gameState = 'START', lastMenuState = 'START';
        
        let totalMP = parseInt(localStorage.getItem('mobis_final_mp')) || 100;
        let myCollection = new Set(JSON.parse(localStorage.getItem('mobis_final_col')) || [28, 999]);
        let selectedId = parseInt(localStorage.getItem('mobis_final_selected')) || 28;
        let bestDist = parseInt(localStorage.getItem('mobis_final_best')) || 0;
        let player = { lane: 0, x: 0, targetX: 0, currentX: 0 };
        let lives = 3, currentLevel = 1, score = 0, earnedMP = 0, shotClock = 100, cameraY = 0, lanes = [], invulnerable = 0, consecutiveRoads = 0;

        const PixelNumbers = {
            '0': [[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]], '1': [[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],
            '2': [[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]], '3': [[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],
            '4': [[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]], '5': [[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],
            '6': [[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]], '7': [[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],
            '8': [[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]], '9': [[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]
        };

        const Colors = { 
            0: null, 1: "#000000", 2: "#ffffff", 3: "#ff0000", 4: "#F5CBA7", 
            5: "#98D8E9", 6: "#e30613", 7: "#ffffff", 8: "#ffca08", 
            9: "#ffaff0", 10: "#9e4300", 11: "#ffffff", 12: "#ffc0cb",
            13: "#f57c00", 14: "#ffeb3b", 15: "#42210b", 16: "#fffde7", 17: "#4a3c31", 18: "#2d241d",
            brown: "#8d6e63", green: "#4caf50", cyan: "#00bcd4", beige: "#d7ccc8"
        };

        // --- ÏÉùÎ™Ö ÏïÑÏù¥ÏΩò (ÎùºÏù¥Ïò®) Îç∞Ïù¥ÌÑ∞ ---
        const LifePalette = { 
            "0": "transparent", "1": "#FFD74B", "2": "#FFD64A", "3": "#FFC839", "4": "#FFCA3B", "5": "#FFD74A", 
            "6": "#FFD649", "7": "#FFCD40", "8": "#FFD346", "9": "#F55F91", "10": "#F03C6E", "11": "#FEBE3D", 
            "12": "#FFCE41", "13": "#F78253", "14": "#FFD041", "15": "#FFC83A", "16": "#FA9B4A", "17": "#FFCB3D"
        };
        const LifeSpriteData = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,3,3,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,3,3,3,1,0,1,3,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,0,0,1,3,3,3,3,3,1,0,1,3,3,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,1,0,5,3,3,3,3,3,3,1,3,3,3,3,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,1,6,3,3,3,3,3,3,1,3,3,3,3,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0], [0,0,0,0,0,0,1,8,3,9,9,9,9,9,3,3,3,3,9,9,9,9,9,3,3,3,0,0,0,0,0,0], [0,0,0,0,0,1,1,3,9,9,9,9,9,9,9,3,3,9,9,9,9,9,9,9,3,3,3,0,0,0,0,0], [0,0,0,0,0,1,3,9,9,10,10,10,10,10,10,9,9,9,10,10,10,10,10,10,9,3,3,0,0,0,0,0], [0,0,0,0,0,1,3,9,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,11,3,3,0,0,0,0], [0,0,0,0,1,3,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,0,0,0,0], [0,0,0,0,1,3,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,0,0,0,0], [0,0,0,0,1,3,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,0,0,0,0], [0,0,0,0,0,1,3,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,12,0,0,0,0], [0,0,0,0,0,1,3,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,0,0,0,0,0], [0,0,0,0,0,1,3,3,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,3,3,0,0,0,0,0], [0,0,0,0,0,0,1,3,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,0,0,0,0,0,0], [0,0,0,0,0,0,0,14,3,10,10,10,10,10,10,10,10,10,10,10,10,10,10,3,3,15,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,10,10,10,10,10,10,10,10,10,10,10,10,3,3,3,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,10,10,10,10,10,10,10,10,10,10,3,3,3,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,3,3,3,10,10,10,10,10,10,16,3,3,3,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,17,3,3,10,10,10,10,3,3,3,7,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ];

        // --- Î∞îÎÇòÎÇò ÏΩîÏù∏ ÌåîÎ†àÌä∏ & Îç∞Ïù¥ÌÑ∞ ---
        const BananaPalette = {
            "0": "transparent", "1": "#FEF2A8", "2": "#FFFFFF", "3": "#EEB6A8", "4": "#FFFEF5", "5": "#F2C5A8", 
            "6": "#FDEDA8", "7": "#FFE266", "8": "#F1C0A8", "9": "#FFE981", "10": "#EFAA66", "11": "#FBD466", 
            "12": "#F0BCA9", "13": "#D0844B", "14": "#EFAB66", "15": "#D68F4E", "16": "#F2B566"
        };
        const BananaSpriteData = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,3,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,3,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,4,1,1,3,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,2,1,1,3,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,3,5,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,3,3,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,1,1,1,3,3,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,6,3,3,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,0,0,1,1,1,2,2,1,1,1,3,3,8,0,0], [0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,0,1,1,1,2,1,1,1,1,3,3,0,0,0], [0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,1,1,2,2,1,1,1,1,3,3,0,0,0], [0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,1,1,2,1,1,1,1,3,3,3,0,0,0], [0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1,1,1,1,1,3,3,3,0,0,0], [0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1,1,1,3,3,3,3,0,0,0], [0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1,1,1,3,3,3,0,0,0,0], [0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,3,3,3,3,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,10,10,10,10,10,10,10,10,11,7,7,7,7,7,3,12,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,10,10,7,7,7,7,7,7,7,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0], [0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,13,7,10,7,7,7,7,7,7,7,7,0,0,0], [0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,13,7,7,10,7,7,7,7,7,7,7,7,0,0,0], [0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,13,7,7,13,10,10,7,7,7,7,7,7,7,0,0,0], [0,0,0,0,10,7,7,7,7,7,7,7,7,7,13,13,7,10,13,10,10,10,7,7,7,7,7,7,0,0,0,0], [0,0,0,10,10,7,7,7,7,7,7,7,13,13,7,7,13,10,10,10,10,10,7,7,7,7,7,7,0,0,0,0], [0,0,0,10,10,14,7,7,7,15,13,13,7,7,10,13,10,10,10,10,10,0,0,7,7,7,7,7,0,0,0,0], [0,0,0,0,10,10,10,13,10,10,10,10,10,10,10,10,10,10,10,0,0,0,0,7,7,7,7,0,0,0,0,0], [0,0,0,0,0,10,10,10,10,10,10,10,10,10,10,10,16,0,0,0,0,0,0,7,7,7,7,0,0,0,0,0], [0,0,0,0,0,0,0,10,10,10,10,10,10,0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0]
        ];

        // --- Ï¥àÏΩîÎ∞î ÏïÑÏù¥ÏΩò Îç∞Ïù¥ÌÑ∞ (ÏöîÏ≤≠ÌïòÏã† Îç∞Ïù¥ÌÑ∞ Î∞òÏòÅ) ---
        const ChocoPalette = {
            "0": "transparent", "1": "#7A3E1A", "2": "#995023", "3": "#E8594A", "4": "#D6D9DB", "5": "#FDB62F",
            "6": "#BF3F3B", "7": "#C88029", "8": "#FAA400", "9": "#FD6F0A", "10": "#CE8629", "11": "#CA483E",
            "12": "#EC6845", "13": "#CB483E"
        };
        const ChocoSpriteData = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,1,1,2,1,1,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,1,1,1,1,1,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,1,2,2,2,1,1,1,1,1,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,1,1,1,1,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,1,2,2,2,2,1,2,2,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,2,2,2,2,2,2,2,2,2,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,4,4,4,2,2,2,2,2,2,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,5,4,4,4,4,4,4,2,2,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,5,5,5,4,4,4,4,4,6,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,3,3,3,3,5,5,7,5,5,8,6,6,6,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,3,3,3,3,5,5,2,5,5,5,3,3,3,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,3,3,3,9,5,5,10,5,5,5,3,3,3,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,3,3,3,3,9,5,9,5,5,5,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,3,3,3,3,5,9,9,9,5,5,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,3,3,3,3,3,3,5,5,5,9,5,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,6,11,3,3,3,3,3,5,5,5,9,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,6,6,6,11,3,3,3,3,12,5,5,9,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,6,6,6,11,3,3,3,3,5,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,6,6,6,11,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,6,6,6,11,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,6,6,6,11,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,6,6,6,11,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,6,6,6,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ];

        const Sprites32 = {
            basketball: Array(32).fill().map((_, r) => {
                let row = Array(32).fill(0); let center = 15.5;
                for(let c=0; c<32; c++) {
                    let dist = Math.sqrt(Math.pow(r-center, 2) + Math.pow(c-center, 2));
                    if(dist < 12) row[c] = 13;
                    if(dist >= 12 && dist < 13.5) row[c] = 1;
                    if(dist < 12) { if(Math.abs(r-center) < 0.8 || Math.abs(c-center) < 0.8) row[c] = 1; }
                }
                return row;
            }),
            gongaji: [
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],
                [0,0,0,1,1,1,1,2,2,1,1,1,2,2,2,3,2,2,2,2,1,1,1,2,2,1,1,1,1,0,0,0],
                [0,0,1,1,2,2,2,2,1,2,2,2,2,2,2,3,2,2,2,2,2,2,2,1,2,2,2,2,1,1,0,0],
                [0,1,2,2,2,2,1,1,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,1,1,2,2,2,2,1,0],
                [1,1,2,2,2,1,2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1,1],
                [1,2,2,2,1,3,3,3,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,3,3,3,1,2,2,2,1],
                [1,2,2,1,2,2,2,3,3,2,1,1,2,2,2,3,2,2,2,2,1,1,2,3,3,2,2,2,1,2,2,1],
                [1,1,2,1,2,2,2,2,3,2,1,1,2,2,1,1,1,1,2,2,1,1,2,3,2,2,2,2,1,2,1,1],
                [0,1,1,2,2,2,2,2,3,3,2,2,2,1,4,1,1,4,1,2,2,2,3,3,2,2,2,2,2,1,1,0],
                [0,0,1,2,2,2,2,2,2,3,2,2,1,4,4,4,4,4,4,1,2,2,3,2,2,2,2,2,2,1,0,0],
                [0,0,1,2,2,2,2,2,2,3,3,3,1,4,4,4,4,4,4,1,3,3,3,2,2,2,2,2,2,1,0,0],
                [0,1,2,2,2,2,2,2,3,3,3,2,1,4,4,4,4,4,4,1,2,3,3,3,2,2,2,2,2,2,1,0],
                [0,1,2,2,3,3,3,3,3,3,2,2,1,4,4,4,4,4,4,1,2,2,3,3,3,3,3,3,2,2,1,0],
                [0,1,3,3,3,2,2,2,2,3,2,2,1,4,4,4,4,4,4,1,2,2,3,2,2,2,2,3,3,3,1,0],
                [0,1,2,2,2,2,2,2,3,2,2,2,2,1,4,4,4,4,1,2,2,2,2,3,2,2,2,2,2,2,1,0],
                [0,1,2,2,2,2,2,3,3,2,2,2,2,2,1,1,1,1,2,2,2,2,2,3,3,2,2,2,2,2,1,0],
                [0,1,2,2,2,2,2,3,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,1,0],
                [0,0,1,2,2,2,3,3,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,3,3,2,2,2,1,0,0],
                [0,0,1,2,2,3,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,3,3,2,2,1,0,0],
                [0,0,1,2,3,3,2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,3,3,2,1,0,0],
                [0,0,0,1,3,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,3,1,0,0,0],
                [0,0,0,1,2,2,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,1,0,0,0],
                [0,0,0,0,1,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,1,0,0,0,0],
                [0,0,0,1,2,1,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,1,2,1,0,0,0],
                [0,0,0,1,2,2,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,2,2,1,0,0,0],
                [0,0,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,1,1,0,0],
                [0,0,1,1,2,2,2,2,2,1,0,0,4,4,0,0,0,4,4,4,0,0,1,2,2,2,2,2,1,1,0,0],
                [0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0]
            ],
            human_base: Array(32).fill().map((_, r) => { let row = Array(32).fill(0); if (r >= 2 && r <= 11) { for(let c=11; c<=20; c++) row[c] = 4; if(r >= 8) { row[13] = 1; row[18] = 1; } } if (r >= 12 && r <= 25) { for(let c=8; c<=23; c++) row[c] = 6; } if (r >= 26) { for(let c=10; c<=14; c++) row[c] = 4; for(let c=17; c<=21; c++) row[c] = 4; } return row; }),
            whale: Array(32).fill().map((_, r) => { let row = Array(32).fill(0); if (r >= 6 && r <= 24) { for(let c=4; c<=27; c++) row[c] = 2; if(r >= 12 && r <= 15) { row[8] = 1; row[23] = 1; } } return row; }),
            hoop: Array(32).fill().map((_, r) => { let row = Array(32).fill(0); if (r < 5) for(let c=0; c<32; c++) row[c] = 2; if (r >= 5 && r <= 8) for(let c=8; c<=24; c++) row[c] = 10; if (r > 8) for(let c=10; c<=22; c++) if((c+r)%2==0) row[c] = 2; return row; }),
            gorilla: Array(32).fill().map((_, r) => { let row = Array(32).fill(0); if (r < 28) for(let c=6; c<=25; c++) row[c] = 17; if (r >= 10 && r <= 14) { row[10]=1; row[21]=1; } return row; }),
            redboo: [ [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,3,3,1,0,0,0,0,0,0,0,1,3,3,1,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,3,1,0,0,0,0,0,0,0,1,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,3,1,0,0,0,0,0,0,0,1,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,3,1,1,1,1,1,1,1,1,3,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,3,1,1,3,3,3,3,3,1,1,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,3,1,1,3,3,3,3,3,1,1,3,3,3,1,1,0,0,0,0,0,0], [0,0,0,0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,0,0,0,0,0], [0,0,0,0,0,0,1,3,3,3,3,3,3,1,2,1,1,1,2,1,3,3,3,3,3,3,1,0,0,0,0,0], [0,0,0,0,0,0,1,3,3,3,3,3,1,1,1,1,1,1,1,1,1,3,3,3,3,3,1,0,0,0,0,0], [0,0,0,0,0,0,1,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,0,0,0,0,0], [0,0,0,0,0,0,1,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,0,0,0,0,0], [0,0,0,0,0,0,1,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,1,1,1,1,1,1,1,1,1,1,1,3,3,3,1,0,0,0,0,0,0], [0,0,0,0,0,0,0,1,3,3,3,1,1,1,1,1,1,1,1,1,1,1,3,3,3,1,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,3,3,3,1,1,1,1,1,1,1,1,1,3,3,3,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,0,0,0,0], [0,0,0,0,0,1,1,1,1,3,3,1,1,1,3,3,3,3,3,1,1,1,3,3,1,1,1,1,0,0,0,0], [0,0,0,0,1,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,1,0,0,0], [0,0,0,0,1,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,0,0,0], [0,0,0,0,0,1,1,3,1,1,2,2,1,1,1,2,1,1,1,2,1,1,1,1,1,3,1,1,0,0,0,0], [0,0,0,0,0,0,0,1,1,1,2,1,2,1,2,1,2,1,2,1,2,1,1,1,1,1,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,1,2,2,1,1,2,1,2,1,2,1,2,1,2,1,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,1,2,1,2,1,2,1,2,1,2,1,2,1,1,1,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,1,1,2,2,1,1,1,2,1,1,1,2,1,1,1,1,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,3,3,3,3,3,1,0,1,3,3,3,3,3,1,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,3,3,3,3,1,1,0,1,1,3,3,3,3,1,0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0] ]
        };

        const playerPool = [
            { id: 28, name: "Í≥µÏïÑÏßÄ", number: "üê∂", isGongaji: true },
            { id: 999, name: "ÎÜçÍµ¨Í≥µ", number: "üèÄ", isBall: true },
            { id: 26, name: "Î≥ÑÍπåÎ£®", number: "üê≥", isWhale: true },
            { id: 12, name: "Ìï®ÏßÄÌõà", number: 12, isLegend: true },
            { id: 6, name: "ÏñëÎèôÍ∑º", number: 6, isLegend: true },
            { id: 30, name: "Í∞ïÌòÑÏàò", number: 30 }, { id: 15, name: "ÍπÄÍ±¥Ìïò", number: 15 },
            { id: 18, name: "ÍπÄÍ∑ºÌòÑ", number: 18 }, { id: 5, name: "ÍπÄÎèôÏ§Ä", number: 5 },
            { id: 24, name: "ÍπÄÌÉúÏôÑ", number: 24 }, { id: 3, name: "Î∞ïÎ¨¥Îπà", number: 3 },
            { id: 13, name: "Î∞ïÏ†ïÌôò", number: 13 }, { id: 20, name: "Î∞ïÏ§ÄÏùÄ", number: 20 },
            { id: 25, name: "Î∞ïÏ§ÄÌòï", number: 25 }, { id: 7, name: "ÏÑúÎ™ÖÏßÑ", number: 7 },
            { id: 23, name: "Ïù¥ÎåÄÍ∑†", number: 23 }, { id: 21, name: "Ïù¥ÎåÄÌóå", number: 21 },
            { id: 19, name: "Ïù¥ÎèÑÌóå", number: 19 }, { id: 0, name: "Ïù¥ÏäπÏö∞", number: 0 },
            { id: 33, name: "Ïù¥ÏäπÌòÑ", number: 33 }, { id: 4, name: "Ïù¥Ïö∞Ï†ï", number: 4 },
            { id: 17, name: "Ï†ÑÏ§ÄÎ≤î", number: 17 }, { id: 1, name: "Ï†ïÏ§ÄÏõê", number: 1 },
            { id: 9, name: "Ï°∞ÌïúÏßÑ", number: 9 }, { id: 22, name: "Ï°¥ Ïù¥Í∑∏Î∂ÄÎàÑ", number: 22 },
            { id: 8, name: "ÌîºÍ≤åÎ°úÏïÑ", number: 8 }, { id: 35, name: "ÏµúÍ∞ïÎØº", number: 35 },
            { id: 2, name: "Ìï¥Î®ºÏ¶à", number: 2 }, { id: 45, name: "ÌîÑÎ¶º", number: 44, isGorilla: true }
        ];

        const opponentPool = [
            { name: "Î†àÎìúÎ∂Ä", team: "Red", isRedBoo: true, number: "üëπ" },
            { name: "Í∞ïÏÉÅÏû¨", team: "ÏõêÏ£º DB", color: "#166534", number: 26 },
            { name: "Í∞ïÏÑ±Ïö±", team: "ÏàòÏõê KT", color: "#000000", number: 77 },
            { name: "Í∞ïÏû¨ÎØº", team: "ÏÑúÏö∏ SK", color: "#c8102e", number: 0 },
            { name: "Í∞ïÏßÄÌõà", team: "Í≥†Ïñë ÏÜåÎÖ∏", color: "#00bcd4", number: 12 },
            { name: "Í∞ïÌÉúÌòÑ", team: "Î∂ÄÏÇ∞ KCC", color: "#002c5f", number: 27 },
            { name: "ÍπÄÍ±¥Ïö∞", team: "ÏÑúÏö∏ SK", color: "#c8102e", number: 31 },
            { name: "ÍπÄÍ≤ΩÏõê", team: "ÏïàÏñë Ï†ïÍ¥ÄÏû•", color: "#9a1032", number: 17 },
            { name: "ÍπÄÍµ≠Ï∞¨", team: "ÎåÄÍµ¨ Í∞ÄÏä§Í≥µÏÇ¨", color: "#005bac", number: 30 },
            { name: "Ïù¥Í¥ÄÌù¨", team: "ÏÑúÏö∏ ÏÇºÏÑ±", color: "#004ea2", number: 11 },
            { name: "ÌóàÏõÖ", team: "Î∂ÄÏÇ∞ KCC", color: "#002c5f", number: 3 }
        ];

        // --- Í∑∏Î¶¨Í∏∞ Ìï®Ïàò: Ïª§Ïä§ÌÖÄ ÌåîÎ†àÌä∏ ÏßÄÏõê ---
        function drawCustomSprite(targetCtx, data, palette, x, y, size) {
            if (!targetCtx || !data) return;
            const pLength = data.length;
            const pSize = size / pLength;
            data.forEach((row, rIdx) => { 
                row.forEach((cIdx, colIdx) => { 
                    const color = palette[cIdx]; 
                    if (color && color !== "transparent") { 
                        targetCtx.fillStyle = color; 
                        targetCtx.fillRect(x + colIdx * pSize, y + rIdx * pSize, Math.ceil(pSize), Math.ceil(pSize)); 
                    } 
                }); 
            });
        }

        function drawSprite32(targetCtx, spriteName, colors, x, y, size) {
            if (!targetCtx) return;
            const data = Sprites32[spriteName];
            if (!data) return;
            const pLength = data.length;
            const pSize = size / pLength;
            data.forEach((row, rIdx) => { 
                row.forEach((cIdx, colIdx) => { 
                    const color = typeof cIdx === 'string' ? Colors[cIdx] : colors[cIdx]; 
                    if (color) { targetCtx.fillStyle = color; targetCtx.fillRect(x + colIdx * pSize, y + rIdx * pSize, Math.ceil(pSize), Math.ceil(pSize)); }
                }); 
            });
        }

        function drawDigit(targetCtx, d, dx, dy, ds) {
            const digitData = PixelNumbers[d]; if(!digitData) return;
            digitData.forEach((row, ri) => row.forEach((p, ci) => { if(p) targetCtx.fillRect(dx + ci * ds, dy + ri * ds, ds, ds); }));
        }

        function drawCharacter(targetCtx, playerObj, x, y, size, teamColor = "#e30613", numOverride = null) {
            if (!targetCtx) return;
            const sColors = {...Colors, 6: teamColor};
            if (playerObj?.isRedBoo) { drawSprite32(targetCtx, 'redboo', { 0: null, 1: "#000000", 2: "#FFFFFF", 3: "#FF0000" }, x, y, size); return; }
            if (playerObj?.isGongaji) { drawCustomSprite(targetCtx, Sprites32.gongaji, { 0: "transparent", 1: "#000000", 2: "#f57c00", 3: "#8d6e63", 4: "#ffffff" }, x, y, size); return; }
            if (playerObj?.isGorilla) drawSprite32(targetCtx, 'gorilla', sColors, x, y, size);
            else if (playerObj?.isBall || playerObj?.id === 999) drawSprite32(targetCtx, 'basketball', Colors, x, y, size);
            else if (playerObj?.isWhale || playerObj?.id === 26) drawSprite32(targetCtx, 'whale', Colors, x, y, size);
            else {
                sColors[3] = playerObj?.hair || "#332211";
                drawSprite32(targetCtx, 'human_base', sColors, x, y, size);
                const num = numOverride || playerObj?.number;
                if (num && !["üê∂", "üê≥", "üèÄ"].includes(String(num))) {
                    targetCtx.fillStyle = "white"; const ns = String(num); const pSize = size / 32;
                    // Ïú†ÎãàÌèº Î≤àÌò∏ Ï¢åÌëú ÎØ∏ÏÑ∏ Ï°∞Ï†ï (Jersey Ï§ëÏïô)
                    if (ns.length === 1) drawDigit(targetCtx, ns[0], x + 13.5 * pSize, y + 16 * pSize, pSize * 1.8);
                    else { drawDigit(targetCtx, ns[0], x + 9 * pSize, y + 17 * pSize, pSize * 1.3); drawDigit(targetCtx, ns[1], x + 16.5 * pSize, y + 17 * pSize, pSize * 1.3); }
                }
            }
            if ([6, 12, 45].includes(playerObj?.id)) {
                const time = Date.now() / 400; const radius = size * 0.65;
                for (let i = 0; i < 3; i++) {
                    const angle = time + (i * Math.PI * 2 / 3);
                    const starX = x + size/2 + Math.cos(angle) * radius; const starY = y + size/2 + Math.sin(angle) * radius;
                    const s = size/18; targetCtx.fillStyle = "#FFCA08";
                    targetCtx.fillRect(starX - s/2, starY - s*2, s, s*4); targetCtx.fillRect(starX - s*2, starY - s/2, s*4, s);
                    targetCtx.fillStyle = "white"; targetCtx.fillRect(starX - s/2, starY - s/2, s, s);
                }
            }
        }

        // --- UI Î∞è Î°úÏßÅ ---
        function syncUI() {
            const map = { 'ui-level': currentLevel, 'ui-score': score, 'ui-mp': totalMP, 'ui-best-game': bestDist, 'ui-best-main': bestDist, 'ui-best-over': bestDist, 'ui-shop-mp': totalMP, 'ui-clear-mp': totalMP, 'ui-collected-count': myCollection.size };
            for (const [id, val] of Object.entries(map)) { const el = document.getElementById(id); if (el) el.innerText = val; }
            const mc = document.getElementById('ui-collect-main'); if(mc) mc.innerText = `ROSTER: ${myCollection.size}/29`;
            const bar = document.getElementById('lives-bar'); if (bar) {
                bar.innerHTML = '';
                for(let i=0; i<lives; i++) {
                    const c = document.createElement('canvas'); c.width = 24; c.height = 24;
                    drawCustomSprite(c.getContext('2d'), LifeSpriteData, LifePalette, 0, 0, 24);
                    bar.appendChild(c);
                }
            }
        }

        function showDamageMsg(msg) {
            const el = document.getElementById('damage-msg');
            if (el) { el.innerText = msg; el.style.display = 'block'; setTimeout(() => el.style.display = 'none', 1500); }
        }

        function saveGameData() {
            localStorage.setItem('mobis_final_mp', totalMP);
            localStorage.setItem('mobis_final_col', JSON.stringify([...myCollection]));
            localStorage.setItem('mobis_final_selected', selectedId);
            localStorage.setItem('mobis_final_best', bestDist);
        }

        function resize() {
            canvas = document.getElementById('game-canvas'); if (!canvas) return;
            ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            // player.lane = 0; // Î¶¨ÏÖã Î∞©ÏßÄ (Ï§ëÏöî!)
            player.targetX = (Math.floor((canvas.width / 2) / GRID_SIZE) * GRID_SIZE);
            if (gameState !== 'PLAYING') player.currentX = player.targetX; 
            renderPreview(); syncUI();
        }

        function addLane(idx) {
            let type = 'safe', color = idx % 2 === 0 ? '#d29145' : '#de9b42', objs = [];
            if (idx > 0 && idx % LEVEL_DIST === 0) { 
                type = 'goal'; color = '#e30613'; objs.push({ x: canvas.width/2 - 40, type: 'hoop' }); consecutiveRoads = 0; 
            } else if (idx > 2) {
                if (Math.random() > 0.4) {
                    type = 'road'; color = '#4a4a4a'; 
                    const enemyCount = Math.min(4, Math.floor(currentLevel / 3) + 1);
                    const speedMult = 1 + (currentLevel * 0.1); 
                    for(let i=0; i<enemyCount; i++) {
                        const enemy = opponentPool[Math.floor(Math.random() * opponentPool.length)];
                        objs.push({ x: Math.random()*(canvas.width-60), speed: (Math.random()*1.5+1.5) * speedMult * (Math.random()>0.5?1:-1), team: enemy.team, name: enemy.name, number: enemy.number, color: enemy.color, isRedBoo: enemy.isRedBoo });
                    }
                } else if (Math.random() > 0.8) {
                    const r = Math.random();
                    let itemKey = 'banana';
                    if (r > 0.5) itemKey = 'chocolate_bar'; // 50:50 ÌôïÎ•†
                    objs.push({ x: Math.floor(Math.random()*(canvas.width/GRID_SIZE-1))*GRID_SIZE + GRID_SIZE/2, type: 'item', itemKey: itemKey });
                }
            }
            lanes.push({ type, color, objects: objs, index: idx });
        }

        function triggerGameOver(reason) {
            if (gameState === 'DYING' || gameState === 'OVER') return;
            gameState = 'DYING'; showDamageMsg(reason); if (animationFrameId) cancelAnimationFrame(animationFrameId);
            setTimeout(() => {
                gameState = 'OVER'; bestDist = Math.max(bestDist, score); saveGameData();
                document.querySelectorAll('.overlay, .view').forEach(v => v.classList.add('hidden'));
                document.getElementById('overlay-over').classList.remove('hidden');
                document.getElementById('ui-final-stats').innerHTML = `STAGE: LV.${currentLevel}<br>DIST: ${score}m`;
                syncUI();
            }, 1000);
        }

        function gameLoop() {
            if (gameState !== 'PLAYING') return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            cameraY += (player.lane * LANE_HEIGHT - cameraY) * 0.1;
            const baseY = canvas.height - 250;

            lanes.forEach(lane => {
                const sY = baseY + (cameraY - lane.index * LANE_HEIGHT);
                if (sY < -LANE_HEIGHT || sY > canvas.height) return;
                ctx.fillStyle = lane.color; ctx.fillRect(0, sY, canvas.width, LANE_HEIGHT);
                
                // Ïó≠Ïàú Î†åÎçîÎßÅ (Î®º Í≥≥ -> Í∞ÄÍπåÏö¥ Í≥≥)
                const objectsToDraw = [...lane.objects]; 
                
                objectsToDraw.forEach((obj, idx) => {
                    if (lane.type === 'road') {
                        obj.x += obj.speed; if (obj.x > canvas.width + 100) obj.x = -150; if (obj.x < -150) obj.x = canvas.width + 100;
                        drawCharacter(ctx, obj, obj.x, sY + 10, 60, obj.color, obj.number);
                        
                        // ÏÉÅÎåÄÌåÄ Ïù¥Î¶ÑÌëú Î∞∞Í≤Ω Î∞è ÌÖçÏä§Ìä∏
                        ctx.fillStyle = "rgba(0,0,0,0.5)";
                        const text = `[${obj.team}] ${obj.name}`;
                        const textWidth = ctx.measureText(text).width;
                        ctx.fillRect(obj.x + 30 - textWidth/2 - 4, sY + 68, textWidth + 8, 14);
                        ctx.fillStyle = 'white'; ctx.font = 'normal 10px Galmuri11'; ctx.textAlign = 'center'; ctx.fillText(text, obj.x + 30, sY + 79);

                        if (invulnerable === 0 && player.lane === lane.index && player.currentX + 40 > obj.x && player.currentX + 20 < obj.x + 60) {
                            lives--; syncUI(); 
                            // Ï∂©Îèå Î¨∏Íµ¨ ÎûúÎç§ ÏÑ†ÌÉù
                            const actions = ['Î∏îÎùΩ', 'Ïä§Ìã∏', 'Íµø ÌååÏö∏'];
                            const action = actions[Math.floor(Math.random() * actions.length)];
                            const msg = `[${obj.team}] ${obj.name}Ïùò ${action}!`;
                            
                            if (lives <= 0) triggerGameOver(msg); 
                            else { 
                                showDamageMsg(msg); 
                                invulnerable = 60; 
                                const container = document.getElementById('game-container');
                                container.classList.remove('hit-effect');
                                void container.offsetWidth; 
                                container.classList.add('hit-effect');
                                const flash = document.getElementById('flash-overlay');
                                flash.style.backgroundColor = 'rgba(255, 0, 0, 0.4)';
                                setTimeout(() => flash.style.backgroundColor = 'transparent', 150);
                            }
                        }
                    } else if (obj.type === 'item') {
                        if (obj.itemKey === 'banana') drawCustomSprite(ctx, BananaSpriteData, BananaPalette, obj.x - 15, sY + 25, 30);
                        else if (obj.itemKey === 'chocolate_bar') drawCustomSprite(ctx, ChocoSpriteData, ChocoPalette, obj.x - 15, sY + 25, 30);
                        
                        if (player.lane === lane.index && Math.abs(player.currentX + 30 - obj.x) < 40) { lane.objects.splice(idx, 1); totalMP += 10; syncUI(); }
                    } else if (obj.type === 'hoop') {
                        drawSprite32(ctx, 'hoop', Colors, obj.x, sY + 5, 80);
                    }
                });
            });

            player.currentX += (player.targetX - player.currentX) * 0.2;
            const jY = Math.sin((Math.abs(player.lane * LANE_HEIGHT - cameraY) / LANE_HEIGHT) * Math.PI) * 50;
            const pObj = playerPool.find(p => p.id === selectedId) || playerPool[0];

            const decayAccel = Math.min(0.8, 0.22 + (currentLevel - 1) * 0.12);
            shotClock -= decayAccel;
            if (shotClock <= 0) { 
                lives--; syncUI(); 
                // ÏÉ∑ÌÅ¥ÎùΩ ÏúÑÎ∞ò Î¨∏Íµ¨ ÎûúÎç§ ÏÑ†ÌÉù
                const violations = ['ÏÉ∑ÌÅ¥ÎùΩ Î∞îÏù¥ÏñºÎ†àÏù¥ÏÖò', 'ÌïòÌîÑÏΩîÌä∏ Î∞îÏù¥ÏñºÎ†àÏù¥ÏÖò', 'ÎçîÎ∏î ÎìúÎ¶¨Î∏î'];
                const violation = violations[Math.floor(Math.random() * violations.length)];
                const msg = `${pObj.name}Ïùò ${violation}!`;
                
                if (lives <= 0) triggerGameOver(msg); else { showDamageMsg(msg); shotClock = 100; } 
            }
            if (invulnerable > 0) invulnerable--;
            document.getElementById('ui-shotclock').style.width = shotClock + '%';
            drawCharacter(ctx, pObj, player.currentX, baseY - jY + 10, 60);
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function startGame() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            resize(); 
            // Reset player.lane to 0 ONLY on new game start
            player.lane = 0; 
            cameraY = 0;

            document.querySelectorAll('.overlay, .view').forEach(o => o.classList.add('hidden'));
            gameState = 'PLAYING'; score = 0; earnedMP = 0; shotClock = 100; lives = 3; currentLevel = 1; consecutiveRoads = 0;
            lanes = []; for(let i=0; i<35; i++) addLane(i); 
            gameLoop();
        }

        function moveForward() {
            if (gameState !== 'PLAYING') return;
            player.lane++; score = player.lane; totalMP += 1; shotClock = 100; 
            if (player.lane > 0 && player.lane % LEVEL_DIST === 0) { gameState = 'QUIZ'; showQuiz(); }
            if (lanes.length < player.lane + 20) addLane(lanes.length); 
            syncUI();
        }

        function showQuiz() {
            const qOverlay = document.getElementById('overlay-quiz'); qOverlay.classList.remove('hidden');
            const mobisPlayers = playerPool.filter(p => !["üèÄ", "üê∂", "üê≥"].includes(String(p.number)) && !p.isGorilla); 
            const target = mobisPlayers[Math.floor(Math.random() * mobisPlayers.length)];
            const isNameQuiz = Math.random() > 0.5;
            document.getElementById('quiz-feedback').classList.add('hidden'); document.getElementById('quiz-next-btn').classList.add('hidden');
            
            if (isNameQuiz) {
                document.getElementById('quiz-question').innerText = `ÌòÑÎåÄÎ™®ÎπÑÏä§ No.${target.number} ÏÑ†ÏàòÏùò Ïù¥Î¶ÑÏùÄ?`;
                let opts = [target.name]; while(opts.length < 4) { const r = mobisPlayers[Math.floor(Math.random()*mobisPlayers.length)].name; if(!opts.includes(r)) opts.push(r); }
                renderOptions(opts, target.name);
            } else {
                document.getElementById('quiz-question').innerText = `${target.name} ÏÑ†ÏàòÏùò Îì±Î≤àÌò∏Îäî?`;
                let opts = [target.number]; while(opts.length < 4) { const r = mobisPlayers[Math.floor(Math.random()*mobisPlayers.length)].number; if(!opts.includes(r)) opts.push(r); }
                renderOptions(opts, target.number);
            }
        }

        function renderOptions(opts, correct) {
            opts.sort(() => Math.random() - 0.5); const container = document.getElementById('quiz-options'); container.innerHTML = '';
            opts.forEach(o => { 
                const b = document.createElement('button'); b.className = 'quiz-option'; b.innerText = o; 
                b.onclick = () => {
                    document.querySelectorAll('.quiz-option').forEach(x => x.disabled = true);
                    const f = document.getElementById('quiz-feedback'); const n = document.getElementById('quiz-next-btn');
                    f.classList.remove('hidden'); n.classList.remove('hidden');
                    if(o == correct){ totalMP += 50; f.innerText = "Ï†ïÎãµ! (+50 MP)"; f.style.color = "green"; } else { f.innerText = `Ïò§Îãµ! Ï†ïÎãµÏùÄ ${correct}`; f.style.color = "red"; }
                    syncUI();
                };
                container.appendChild(b);
            });
        }

        function moveToClearScreen() { document.getElementById('overlay-quiz').classList.add('hidden'); gameState = 'LEVEL_CLEAR'; document.getElementById('overlay-clear').classList.remove('hidden'); syncUI(); }
        function continueGame() { currentLevel++; shotClock = 100; document.getElementById('overlay-clear').classList.add('hidden'); gameState = 'PLAYING'; gameLoop(); }
        function switchTab(tab) { lastMenuState = gameState; document.querySelectorAll('.view, .overlay').forEach(v => v.classList.add('hidden')); document.getElementById(`view-${tab}`).classList.remove('hidden'); if(tab==='collection') renderCollection(); syncUI(); }
        
        function closeViews() { 
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden')); 
            // ÌòÑÏû¨ Í≤åÏûÑ ÏÉÅÌÉúÏóê Îî∞Îùº Ï†ÅÏ†àÌïú ÌôîÎ©¥ Î≥µÍµ¨
            if (gameState === 'LEVEL_CLEAR') {
                document.getElementById('overlay-clear').classList.remove('hidden');
            } else if (gameState === 'QUIZ') {
                document.getElementById('overlay-quiz').classList.remove('hidden');
            } else if (gameState === 'OVER') {
                document.getElementById('overlay-over').classList.remove('hidden');
            } else if (gameState === 'START') {
                document.getElementById('overlay-start').classList.remove('hidden');
            }
            renderPreview(); syncUI(); 
        }

        function renderPreview() { if(!document.getElementById('preview-canvas')) return; const cp = document.getElementById('preview-canvas').getContext('2d'); cp.clearRect(0,0,80,80); drawCharacter(cp, playerPool.find(p=>p.id===selectedId), 0,0,80); }
        
        function resetGame() { 
            gameState = 'START'; score = 0; earnedMP = 0; lives = 3; currentLevel = 1; 
            document.querySelectorAll('.overlay, .view').forEach(v => v.classList.add('hidden')); 
            document.getElementById('overlay-start').classList.remove('hidden'); 
            resize(); 
        }

        function buyLife() {
            if (totalMP < 500) return showDamageMsg("MP Î∂ÄÏ°±!");
            if (lives >= MAX_LIVES) return showDamageMsg("Ïù¥ÎØ∏ ÏÉùÎ™ÖÏù¥ Í∞ÄÎìù Ï∞ºÏäµÎãàÎã§!");
            totalMP -= 500; lives++; syncUI(); showDamageMsg("ÏÉùÎ™Ö Ï∂©Ï†Ñ ÏôÑÎ£å! ‚ù§Ô∏è");
        }

        function scoutPlayer() {
            const avail = playerPool.filter(p => !myCollection.has(p.id));
            if (avail.length === 0) return showDamageMsg("Î™®Îì† ÏÑ†ÏàòÎ•º ÏòÅÏûÖÌñàÏäµÎãàÎã§!");
            if (totalMP < 100) return showDamageMsg("MP Î∂ÄÏ°±!");
            totalMP -= 100; const p = avail[Math.floor(Math.random() * avail.length)];
            myCollection.add(p.id); saveGameData(); syncUI();
            const modal = document.getElementById('modal'); modal.classList.remove('hidden');
            document.getElementById('scout-result').innerHTML = `
                <div class="id-card">
                    <div class="id-header"><span>PHOEBUS OFFICIAL</span><span>PLAYER CARD</span></div>
                    <div class="id-body text-black">
                        <div class="id-photo-area"><canvas id="card-canvas" width="80" height="80"></canvas></div>
                        <div class="id-info-main">
                            <div class="id-team">ULSAN HYUNDAI MOBIS</div>
                            <div class="id-name">${p.name}</div>
                            <div class="id-number">#${p.number}</div>
                        </div>
                    </div>
                    <div class="id-footer text-black">
                        <div class="info-row"><span class="info-label">POSITION</span><span class="info-val">${p.pos || '-'}</span></div>
                        <div class="info-row"><span class="info-label">PHYSICAL</span><span class="info-val">${p.height || '-'}/${p.weight || '-'}</span></div>
                        <div class="info-row" style="grid-column: span 2"><span class="info-label">DRAFT</span><span class="info-val">${p.draft || '-'}</span></div>
                    </div>
                    <button onclick="document.getElementById('modal').classList.add('hidden')" class="btn-pixel w-full mt-4 h-10 text-white text-xs font-normal uppercase">Confirm</button>
                </div>`;
            setTimeout(() => { const c = document.getElementById('card-canvas'); if(c) drawCharacter(c.getContext('2d'), p, 0, 0, 80); }, 50);
        }

        function renderCollection() {
            const grid = document.getElementById('player-grid'); if(!grid) return; grid.innerHTML = '';
            const sorted = [...playerPool].sort((a,b) => (a.id===28?-1:b.id===28?1:a.id===999?-1:b.id===999?1:String(a.number).localeCompare(String(b.number), undefined, {numeric:true})));
            sorted.forEach(p => {
                const owned = myCollection.has(p.id), sel = selectedId === p.id;
                grid.innerHTML += `<div onclick="${owned?`selectPlayerFromRoster(${p.id})`:''}" class="p-2 border-4 ${sel?'border-yellow-400 bg-yellow-50':'border-black'} bg-white text-center"><canvas id="item-${p.id}" width="64" height="64" class="mx-auto ${owned?'':'grayscale opacity-30'}"></canvas><div class="text-[10px] mt-1 text-black font-normal">${owned?p.name:'??'}</div></div>`; setTimeout(()=> { if(document.getElementById(`item-${p.id}`)) drawCharacter(document.getElementById(`item-${p.id}`).getContext('2d'), p, 0,0,64); }, 50); });
        }

        function selectPlayerFromRoster(id) { 
            selectedId = id; 
            saveGameData(); 
            renderCollection(); 
            renderPreview(); 
            // ÏÑ†ÌÉù ÌõÑ ÏûêÎèôÏúºÎ°ú Ï∞Ω Îã´Í≥† Î≥µÍ∑Ä
            closeViews();
        }
        
        function togglePause() { if (gameState === 'PLAYING') gameState = 'PAUSED'; else if (gameState === 'PAUSED') { gameState = 'PLAYING'; gameLoop(); } }

        window.onload = resize;
        window.addEventListener('resize', resize);
        window.addEventListener('keydown', (e) => {
            if (e.repeat || gameState !== 'PLAYING') return;
            if (e.code === 'ArrowUp' || e.code === 'Space') moveForward();
            if (e.code === 'ArrowLeft') player.targetX = Math.max(0, player.targetX - GRID_SIZE);
            if (e.code === 'ArrowRight') player.targetX = Math.min(canvas.width - GRID_SIZE, player.targetX + GRID_SIZE);
        });
    </script>
</body>
</html>